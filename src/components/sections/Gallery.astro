---
/**
 * Gallery/Portfolio Section Component
 * Displays completed painting projects in a grid layout with toggle between residential and commercial
 */
import Button from "@/components/ui/Button.astro";
import { getGalleryContent } from "@/lib/tina";

// Load content from Tina CMS
const content = getGalleryContent();

const label = content?.label || "Portfolio";
const title = content?.title || "Completed Projects";
const residentialImages = content?.residential || [];
const commercialImages = content?.commercial || [];
---

<section id="gallery" class="py-24 px-6 bg-muted/30">
  <div class="max-w-7xl mx-auto">
    <div class="text-center mb-16">
      <span
        class="text-sm font-medium tracking-wider text-muted-foreground uppercase"
      >
        {label}
      </span>
      <h2
        class="text-5xl sm:text-6xl md:text-7xl lg:text-8xl mb-16 sm:mb-20 tracking-tight font-bold text-start"
      >
        {title}
      </h2>

      <!-- Toggle Button -->
      <div class="flex justify-start mt-8">
        <ul class="inline-flex gap-8 items-start">
          <li class="relative button-wrapper">
            <button
              class="relative z-50 px-6 py-3 font-medium hover-brush text-2xl toggle-btn"
              data-category="residential"
              aria-pressed="true"
            >
              Residential
            </button>
          </li>
          <li class="relative button-wrapper">
            <button
              class="relative z-10 px-6 py-3 font-medium hover-brush text-2xl toggle-btn"
              data-category="commercial"
              aria-pressed="false"
            >
              Commercial
            </button>
          </li>
        </ul>
      </div>
    </div>

    <!-- Gallery Grid -->
    <div class="gallery-wrapper">
      <!-- Residential Gallery -->
      <div
        id="residential-gallery"
        class="gallery-container active grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
      >
        {
          residentialImages.map((image) => (
            <div class="gallery-item group relative aspect-square overflow-hidden rounded-sm cursor-pointer">
              <img
                src={image.url}
                alt={image.alt}
                class="object-cover w-full h-full grayscale group-hover:grayscale-0 group-hover:scale-110 transition-all duration-500"
                loading="lazy"
              />
              <div class="absolute inset-0 bg-gradient-to-t from-primary/60 via-primary/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300" />
              <div class="absolute inset-0 flex items-end p-6 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                <p class="text-white font-medium text-sm">{image.alt}</p>
              </div>
            </div>
          ))
        }
      </div>

      <!-- Commercial Gallery -->
      <div
        id="commercial-gallery"
        class="gallery-container grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
      >
        {
          commercialImages.map((image) => (
            <div class="gallery-item group relative aspect-square overflow-hidden rounded-sm cursor-pointer">
              <img
                src={image.url}
                alt={image.alt}
                class="object-cover w-full h-full grayscale group-hover:grayscale-0 group-hover:scale-110 transition-all duration-500"
                loading="lazy"
              />
              <div class="absolute inset-0 bg-gradient-to-t from-primary/60 via-primary/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300" />
              <div class="absolute inset-0 flex items-end p-6 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                <p class="text-white font-medium text-sm">{image.alt}</p>
              </div>
            </div>
          ))
        }
      </div>
    </div>
  </div>
</section>

<style>
  .paint-button {
    fill: none;
    stroke: black;
    stroke-width: 50;
    stroke-dasharray: 3000;
    stroke-dashoffset: 3000;
  }

  .paint-button.animate {
    animation: drawPath 8s ease-out forwards;
  }

  @keyframes drawPath {
    from {
      stroke-dashoffset: 3000;
    }
    to {
      stroke-dashoffset: 0;
    }
  }

  .toggle-btn {
    color: black;
    transition: color 0.3s ease;
  }

  .gallery-wrapper {
    position: relative;
    min-height: 400px;
  }

  .gallery-container {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.4s ease-in-out;
  }

  .gallery-container.active {
    position: relative;
    opacity: 1;
    pointer-events: auto;
  }

  .gallery-container.active .gallery-item {
    animation: slideUp 0.5s ease-out backwards;
  }

  .gallery-container.active .gallery-item:nth-child(1) {
    animation-delay: 0.05s;
  }
  .gallery-container.active .gallery-item:nth-child(2) {
    animation-delay: 0.1s;
  }
  .gallery-container.active .gallery-item:nth-child(3) {
    animation-delay: 0.15s;
  }
  .gallery-container.active .gallery-item:nth-child(4) {
    animation-delay: 0.2s;
  }
  .gallery-container.active .gallery-item:nth-child(5) {
    animation-delay: 0.25s;
  }
  .gallery-container.active .gallery-item:nth-child(6) {
    animation-delay: 0.3s;
  }
  .gallery-container.active .gallery-item:nth-child(7) {
    animation-delay: 0.35s;
  }
  .gallery-container.active .gallery-item:nth-child(8) {
    animation-delay: 0.4s;
  }
  .gallery-container.active .gallery-item:nth-child(9) {
    animation-delay: 0.45s;
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const toggleButtons =
      document.querySelectorAll<HTMLButtonElement>(".toggle-btn");
    const galleries =
      document.querySelectorAll<HTMLElement>(".gallery-container");
    const buttonWrappers =
      document.querySelectorAll<HTMLElement>(".button-wrapper");

    function setActive(category: string | undefined) {
      if (!category) return;

      // Update button states
      toggleButtons.forEach((btn) => {
        const isActive = btn.dataset.category === category;
        btn.classList.toggle("border-b-4", isActive);
        btn.classList.toggle("border-primary", isActive);
        btn.classList.toggle("active", isActive);
        btn.setAttribute("aria-pressed", isActive ? "true" : "false");
      });

      // Update active gallery
      galleries.forEach((gallery) => {
        gallery.classList.toggle(
          "active",
          gallery.id === `${category}-gallery`
        );
      });
    }

    // Initialize with residential
    setActive("residential");

    // Add click handlers
    toggleButtons.forEach((button, index) => {
      button.addEventListener("click", () => {
        const category = button.dataset.category;
        setActive(category);

        // Animate SVG for clicked button
        buttonWrappers.forEach((wrapper, wrapperIndex) => {
          const svgPolyline =
            wrapper.querySelector<SVGPolylineElement>(".paint-button");
          if (svgPolyline) {
            svgPolyline.classList.remove("animate");

            if (wrapperIndex === index) {
              void wrapper.offsetWidth; // Force reflow
              svgPolyline.classList.add("animate");
            }
          }
        });
      });
    });
  });
</script>
