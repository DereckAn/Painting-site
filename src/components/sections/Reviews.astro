---
// src/components/sections/Reviews.astro

// Datos hardcoded de reviews hasta tener acceso a Google Reviews API
const reviews = [
  {
    id: 1,
    text: "We're always willing to wait until he's available... he leaves everything looking brand new!",
    author: "Judy Minnett",
    image: "https://images.unsplash.com/photo-1562259949-e8e7689d7828?q=80&w=2000",
    imageAlt: "Freshly painted living room",
  },
  {
    id: 2,
    text: "Outstanding work! The attention to detail was impressive and the crew was professional and respectful of our home.",
    author: "Michael Johnson",
    image: "https://images.unsplash.com/photo-1589939705384-5185137a7f0f?q=80&w=2000",
    imageAlt: "Modern painted bedroom",
  },
  {
    id: 3,
    text: "Best painting service in town! They transformed our office space and completed the project ahead of schedule.",
    author: "Sarah Williams",
    image: "https://images.unsplash.com/photo-1556912172-45b7abe8b7e1?q=80&w=2000",
    imageAlt: "Commercial office space",
  },
];
---

<section class="bg-black text-white py-20 sm:py-24 overflow-hidden">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Título -->
    <h2
      class="text-5xl sm:text-6xl md:text-7xl lg:text-8xl mb-16 sm:mb-20 font-bold"
    >
      Our Customers
    </h2>

    <!-- Embla Carousel Container -->
    <div class="relative">
      <div class="embla" data-embla>
        <div class="embla__container">
          {
            reviews.map((review) => (
              <div class="embla__slide">
                <div class="flex flex-col lg:flex-row items-center">
                  <!-- Imagen del proyecto -->
                  <div class="w-full lg:w-1/2">
                    <div class="relative rounded-lg overflow-hidden shadow-2xl aspect-[4/3]">
                      <img
                        src={review.image}
                        alt={review.imageAlt}
                        class="w-full h-full object-cover"
                      />
                    </div>
                  </div>

                  <!-- Tarjeta de Review con SVG animado -->
                  <div class="flex justify-center lg:justify-start">
                    <div class="testimonial-wrapper relative">

                      <!-- Tarjeta principal -->
                      <div class="testimonial-card relative  text-black p-8 sm:p-10 lg:p-12 rounded-lg shadow-2xl max-w-xl overflow-hidden">
                        <!-- SVG animado de fondo -->
                        <div class="testimonial-bg absolute inset-0 pointer-events-none">
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 489.02 350.02"
                            preserveAspectRatio="none"
                            class="w-full h-full"
                            aria-hidden="true"
                          >
                            <g>
                              <polyline
                                class="testimonial-paint-path"
                                points="72.88 48.14 87.87 314.09 159.78 23.37 168.06 307.68 254.91 27.18 259.67 326.65 362.14 23.37 360.33 331.11 407.52 48.83 416.07 302.49"
                              />
                            </g>
                          </svg>
                        </div>

                        <!-- Comillas SVG -->
                        <div class="quotes relative mb-6 w-12 h-8">
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 40.48 25.55"
                            class="w-full h-full"
                          >
                            <path
                              class="quotes-svg"
                              d="M0,25.55v-13.85L4.91,0h10.12l-3.14,11.3h6.09v14.25H0ZM22.5,25.55v-13.85L27.41,0h10.12l-3.14,11.3h6.09v14.25h-17.98Z"
                            />
                          </svg>
                        </div>

                        <!-- Texto del review -->
                        <div class="relative z-10">
                          <p class="text-base sm:text-lg lg:text-xl leading-relaxed mb-8">
                            {review.text}
                          </p>

                          <!-- Nombre del cliente -->
                          <div class="author-wrapper">
                            <div class="author inline-block border-2 border-black px-6 py-3 font-bold text-sm sm:text-base">
                              <span>{review.author}</span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            ))
          }
        </div>
      </div>

    </div>

    <!-- Navegación con flechas en la parte inferior -->
    <div class="flex justify-center gap-4 mt-8">
      <button
        class="embla-prev arrow-button arrow-left bg-white text-black hover:bg-gray-200 transition-all"
        aria-label="Previous review"
      >
        <svg
          class="w-5 h-5"
          fill="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
        </svg>
      </button>

      <button
        class="embla-next arrow-button arrow-right bg-white text-black hover:bg-gray-200 transition-all"
        aria-label="Next review"
      >
        <svg
          class="w-5 h-5"
          fill="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path>
        </svg>
      </button>
    </div>
  </div>

    <!-- Enlace a Google Reviews -->
    <div class="mt-12 flex justify-center lg:justify-end">
      <a
        href="https://www.google.com/maps"
        target="_blank"
        rel="noopener noreferrer"
        class="link-text inline-flex items-center gap-2 text-base sm:text-lg font-bold underline hover:no-underline transition-all group"
      >
        <span>More Reviews on Google</span>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 9.2 9.2"
          class="w-4 h-4 sm:w-5 sm:h-5 transition-transform group-hover:translate-x-1 group-hover:-translate-y-1"
        >
          <polyline
            class="arrow-svg"
            points="8.7 8.85 8.7 .5 .35 .5"
            fill="none"
            stroke="currentColor"
            stroke-miterlimit="10"></polyline>
          <line
            class="arrow-svg"
            x1="8.7"
            y1=".5"
            x2=".35"
            y2="8.85"
            stroke="currentColor"
            stroke-miterlimit="10"></line>
        </svg>
      </a>
    </div>
  </div>
</section>

<style>
  /* Embla Carousel Styles */
  .embla {
    overflow: hidden;
  }

  .embla__container {
    display: flex;
  }

  .embla__slide {
    flex: 0 0 100%;
    min-width: 0;
  }

  /* Efecto de capas en la tarjeta */
  .testimonial-wrapper {
    position: relative;
    width: 100%;
  }

  .testimonial-layer {
    z-index: 0;
  }

  .testimonial-card {
    position: relative;
    z-index: 10;
  }

  /* SVG animado de fondo del testimonio */
  .testimonial-bg {
    z-index: 0;
  }

  .testimonial-paint-path {
    fill: none;
    stroke: #ffffff;
    stroke-width: 90px;
    stroke-dasharray: 3000;
    stroke-dashoffset: 3000;
    animation: drawTestimonialPath 3s ease-out forwards;
  }

  @keyframes drawTestimonialPath {
    from {
      stroke-dashoffset: 3000;
    }
    to {
      stroke-dashoffset: 0;
    }
  }

  /* Comillas SVG */
  .quotes-svg {
    fill: #000000;
  }

  /* Botones de navegación con forma de flecha */
  .arrow-button {
    position: relative;
    padding: 1rem 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border: none;
    font-weight: bold;
  }

  .arrow-left {
    clip-path: polygon(20% 0%, 100% 0%, 100% 100%, 20% 100%, 0% 50%);
    padding-left: 2rem;
  }

  .arrow-right {
    clip-path: polygon(0% 0%, 80% 0%, 100% 50%, 80% 100%, 0% 100%);
    padding-right: 2rem;
  }

  .arrow-button:hover {
    transform: scale(1.05);
  }

  /* Responsive: ocultar capas decorativas en móvil */
  @media (max-width: 640px) {
    .testimonial-layer {
      display: none;
    }

    .arrow-button {
      padding: 0.75rem 1.25rem;
    }

    .arrow-left {
      padding-left: 1.5rem;
    }

    .arrow-right {
      padding-right: 1.5rem;
    }
  }

  /* Reducir el movimiento para usuarios que lo prefieren */
  @media (prefers-reduced-motion: reduce) {
    .testimonial-paint-path,
    .testimonial-content {
      animation: none;
      opacity: 1;
    }

    .testimonial-paint-path {
      stroke-dashoffset: 0;
    }
  }
</style>

<script>
  import EmblaCarousel from "embla-carousel";
import Autoplay from "embla-carousel-autoplay";

  // Inicializar Embla Carousel
  const emblaNode = document.querySelector(".embla") as HTMLElement;
  const prevBtn = document.querySelector(".embla-prev") as HTMLButtonElement;
  const nextBtn = document.querySelector(".embla-next") as HTMLButtonElement;

  if (emblaNode) {
    const emblaApi = EmblaCarousel(emblaNode, { loop: true }, [
      Autoplay({ delay: 8000, stopOnInteraction: false }),
    ]);

    // Navegación con botones
    if (prevBtn) {
      prevBtn.addEventListener("click", () => emblaApi.scrollPrev());
    }

    if (nextBtn) {
      nextBtn.addEventListener("click", () => emblaApi.scrollNext());
    }
  }
</script>
